{"version":3,"sources":["../../../src/js/lib/svgText.js"],"names":["$","window","document","undefined","Plugin","element","options","this","el","extend","defaults","_defaults","_name","pluginName","init","loaderHolderClass","compiledClass","wordClass","spaceClass","orphanWrapClass","originalTextClass","processingClass","convertedClass","failClass","compiledElement","wordElement","spaceElement","orphanWrapElement","originalTextElement","heightBasis","letterCountMap","loader_cache","prototype","me","$el","src","data","loader","addClass","indexOf","css","height","overflow","attr","appendTo","load","resp","status","removeClass","push","generateSText","classes","compiled","createEl","parser","dom","text","words","DOMParser","parseFromString","body","textContent","trim","split","word_count","length","total_letter_count","prefix","zflow","last_word","last_letters","next_last_word","next_last_letters","className","console","log","forEach","word","i","letters","letter_count","wordEl","zIndex","style","letter","useLetter","toUpperCase","match","charCodeAt","toString","viewBox","def","symbol","find","dimensions","ratio","xmlns","svg","createElNS","setAttribute","setAttributeNS","use","width","appendChild","original","innerText","spacer","space","innerHTML","wrapWords","letter_class","n","html","setTimeout","$compiled","$orphans","children","slice","wrap","first","wrapAll","type","createElement","ns","createElementNS","fn","each","jQuery"],"mappings":"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","sourcesContent":["/*!\n * jQuery lightweight plugin boilerplate\n * Original author: @ajpiano\n * Further changes, comments: @addyosmani\n * Licensed under the MIT license\n */\n\n(function ( $, window, document, undefined ) {\n\n\tvar pluginName = \"svgText\",\n\t\tdefaults = {\n\t\t\tloaderHolderClass: \"stext_loader\",\n\t\t\tcompiledClass: 'st-comp',\n\t\t\twordClass: 'st-word',\n\t\t\tspaceClass: 'st-space',\n\t\t\torphanWrapClass: 'st-orphan',\n\t\t\toriginalTextClass: 'st-original',\n\t\t\tprocessingClass: 'st-processing',\n\t\t\tconvertedClass: 'st-converted',\n\t\t\tfailClass: 'st-failed',\n\t\t\tcompiledElement: 'span',\n\t\t\twordElement: 'span',\n\t\t\tspaceElement: 'span',\n\t\t\torphanWrapElement: 'span',\n\t\t\toriginalTextElement: 'span',\n\t\t\theightBasis: '1.15em',\n\t\t\tletterCountMap: [\n\t\t\t\t8, 9, 11, 14, 16\n\t\t\t]\n\t\t},\n\t\tloader_cache = [];\n\n\t// The actual plugin constructor\n\tfunction Plugin( element, options ) {\n\t\tthis.el = element;\n\n\t\t// jQuery has an extend method that merges the\n\t\t// contents of two or more objects, storing the\n\t\t// result in the first object. The first object\n\t\t// is generally empty because we don't want to alter\n\t\t// the default options for future instances of the plugin\n\t\tthis.options = $.extend( {}, defaults, options) ;\n\n\t\tthis._defaults = defaults;\n\t\tthis._name = pluginName;\n\n\t\tthis.init();\n\t}\n\n\tPlugin.prototype = {\n\n\t\tinit: function() {\n\t\t\t// Place initialization logic here\n\t\t\t// You already have access to the DOM element and\n\t\t\t// the options via the instance, e.g. this.element\n\t\t\t// and this.options\n\t\t\t// you can add more functions like the one below and\n\t\t\t// call them like so: this.yourOtherFunction(this.element, this.options).\n\t\t\t\n\t\t\tvar me = this,\n\t\t\t\t$el = $(this.el),\n\t\t\t\tsrc = $el.data('st-src');\n\n\t\t\t$el.addClass(me.options.processingClass);\n\n\t\t\tif (loader_cache.indexOf(src) < 0) {\n\t\t\t\tvar loader = $('<div class=\"' + this.options.loaderHolderClass +'\">');\n\t\t\t\tloader.css({\n\t\t\t\t\t\theight: 0,\n\t\t\t\t\t\toverflow: 'hidden'\n\t\t\t\t\t})\n\t\t\t\t\t.attr('data-src', src)\n\t\t\t\t\t.appendTo('body')\n\t\t\t\t\t.load(\n\t\t\t\t\t\tsrc,\n\t\t\t\t\t\tfunction(resp, status) {\n\t\t\t\t\t\t\tif (resp == 'error') {\n\t\t\t\t\t\t\t\t$el.removeClass(me.options.processingClass)\n\t\t\t\t\t\t\t\t\t.addClass(me.options.failClass);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\tloader_cache.push(src);\n\t\t\t}\n\t\t\tme.generateSText(me.el);\n\n\t\t},\n\n\t\tgenerateSText: function(el, options) {\n\t\t\tvar me = this,\n\t\t\t\t$el = $(el),\n\t\t\t\tsrc = $el.data('st-src'),\n\t\t\t\tclasses = $el.attr('class'),\n\t\t\t\tcompiled = me.createEl(me.options.compiledElement);\n\n\t\t\t// decode text\n\t\t\tvar parser = new DOMParser,\n\t\t\t\tdom = parser.parseFromString(\n\t\t\t    '<!doctype html><body>' + $el.text(),\n\t\t\t    'text/html');\n\t\t\t    \n\t\t\tvar text = dom.body.textContent,\n\t\t\t\twords = text.trim().split(/[\\s\\t\\n\\r]+/),\n\t\t\t\tword_count = words.length,\n\t\t\t\ttotal_letter_count = 0;\n\n\t\t\t$el.attr('data-wc', word_count);\n\n\t\t\tvar loader = $('.' + me.options.loaderHolderClass + '[data-src=\"' + src + '\"] svg'),\n\t\t\t\tprefix = loader.data('prefix'),\n\t\t\t\tzflow = loader.data('zflow') || '+';\n\n\t\t\tif (\n\t\t\t\t! loader.length ||\n\t\t\t\t! prefix\n\t\t\t) {\n\t\t\t\t// SVG hasn't finished loading, wait it out\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tme.generateSText(el, me.options);\n\t\t\t\t}, 50);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcompiled.className = me.options.compiledClass;\n\n\t\t\tconsole.log(\"Words\", words);\n\n\t\t\twords.forEach(function(word, i) {\n\t\t\t\tvar letters = word.split(''),\n\t\t\t\t\tletter_count = letters.length,\n\t\t\t\t\twordEl = me.createEl(me.options.wordElement),\n\t\t\t\t\tzIndex = word_count - i;\n\n\t\t\t\tif (zflow == '+') {\n\t\t\t\t\tzIndex = word_count + i;\n\t\t\t\t}\n\n\t\t\t\ttotal_letter_count += letter_count;\n\n\t\t\t\twordEl.className = me.options.wordClass;\n\t\t\t\twordEl.style.zIndex = zIndex;\n\n\t\t\t\tconsole.log(\"Letters\", letters);\n\n\t\t\t\tletters.forEach(function(letter, i) {\n\t\t\t\t\tletter = letter.toUpperCase();\n\n\t\t\t\t\tvar useLetter = letter;\n\n\t\t\t\t\t// if letter is not alphanumeric, use hex code\n\t\t\t\t\tif ( ! letter.match(/[A-Z0-9]/)) {\n\t\t\t\t\t\tuseLetter = '_x' + letter.charCodeAt(0).toString(16).toUpperCase() + '_';\n\t\t\t\t\t}\n\n\t\t\t\t\tconsole.log(\"Using letter\", useLetter);\n\n\t\t\t\t\tvar viewBox = \"0 0 100 100\",\n\t\t\t\t\t\tdef = '#' + prefix + '_' + useLetter,\n\t\t\t\t\t\tsymbol = loader.find(def);\n\t\t\t\t\tif (symbol.length) {\n\t\t\t\t\t\tviewBox = symbol.attr('viewBox');\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tvar dimensions = viewBox.split(' ');\n\t\t\t\t\tif (dimensions.length < 3) {\n\t\t\t\t\t\tthrow \"Invalid viewbox on symbol '\" + letter + \"'\"; \n\t\t\t\t\t}\n\n\t\t\t\t\tvar ratio = (dimensions[2]/dimensions[3]);\n\n\t\t\t\t\tvar xmlns = \"http://www.w3.org/2000/svg\",\n\t\t\t\t\t\tsvg = me.createElNS(xmlns, 'svg');\n\t\t\t\t\tsvg.setAttribute('data-l', letter);\n\t\t\t\t\tsvg.setAttribute('data-w', dimensions[3]);\n\t\t\t\t\tsvg.setAttributeNS(\n\t\t\t\t\t\t\"http://www.w3.org/2000/xmlns/\",\n\t\t\t\t\t\t\"xmlns:xlink\",\n\t\t\t\t\t\t\"http://www.w3.org/1999/xlink\"\n\t\t\t\t\t);\n\n\t\t\t\t\tvar use = me.createElNS(xmlns, 'use');\n\t\t\t\t\tuse.setAttributeNS(\n\t\t\t\t\t\t'http://www.w3.org/1999/xlink',\n\t\t\t\t\t\t'xlink:href',\n\t\t\t\t\t\t'#' + prefix + '_' + useLetter\n\t\t\t\t\t);\n\t\t\t\t\tuse.setAttribute('class', classes);\n\n\t\t\t\t\tvar zIndex = letter_count - i;\n\t\t\t\t\tif (zflow == '+') {\n\t\t\t\t\t\tzIndex = letter_count + i;\n\t\t\t\t\t}\n\n\t\t\t\t\tsvg.style.zIndex = zIndex;\n\t\t\t\t\tsvg.style.width = 'calc( ' + \n\t\t\t\t\t\tme.options.heightBasis + \n\t\t\t\t\t\t' * ' + ratio + ' )';\n\n\t\t\t\t\tsvg.appendChild(use);\n\n\t\t\t\t\twordEl.appendChild(svg);\n\n\t\t\t\t\tif (i === 0) {\n\t\t\t\t\t\twordEl.setAttribute('data-fl', letter);\n\t\t\t\t\t}\n\t\t\t\t\tif (i === letter_count - 1) {\n\t\t\t\t\t\twordEl.setAttribute('data-ll', letter);\n\t\t\t\t\t}\n\n\t\t\t\t});\n\n\t\t\t\tvar original = me.createEl(me.options.originalTextElement);\n\t\t\t\t\toriginal.className = me.options.originalTextClass;\n\t\t\t\t\toriginal.innerText = word;\n\t\t\t\twordEl.appendChild(original);\n\n\t\t\t\tcompiled.appendChild(wordEl);\n\n\t\t\t\tif (i + 1 < word_count) {\n\t\t\t\t\tvar spacer = me.createEl(me.options.spaceElement);\n\t\t\t\t\tspacer.setAttribute('class', me.options.spaceClass);\n\n\t\t\t\t\tvar space = me.createEl(me.options.originalTextElement);\n\t\t\t\t\t\tspace.className = me.options.originalTextClass;\n\t\t\t\t\t\tspace.innerHTML = '&nbsp;';\n\n\t\t\t\t\tspacer.appendChild(space);\n\n\t\t\t\t\tcompiled.appendChild(spacer);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// If last word is short, wrap the last two to\n\t\t\t// prevent ugly orphans\n\t\t\tif (words.length > 2) {\n\t\t\t\tvar last_word = words[words.length-1],\n\t\t\t\t\tlast_letters = last_word.split('');\n\n\t\t\t\tif (last_letters.length < 5) {\n\t\t\t\t\t\n\t\t\t\t\tcompiled = me.wrapWords(compiled);\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// Last word wasn't short, but is the one before it?\n\t\t\t\t\tvar next_last_word = words[words.length-2],\n\t\t\t\t\t\tnext_last_letters = next_last_word.split('');\n\n\t\t\t\t\tif (next_last_letters.length < 5) {\n\t\t\t\t\t\tcompiled = me.wrapWords(compiled);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar letter_class = 0;\n\t\t\tme.options.letterCountMap.forEach(function(n, i) {\n\t\t\t\tif (total_letter_count >= n) {\n\t\t\t\t\tletter_class = i;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t$el\n\t\t\t\t.attr('data-lcl', letter_class)\n\t\t\t\t.attr('data-tlc', total_letter_count)\n\t\t\t\t.html(compiled)\n\t\t\t\t.removeClass(me.options.processingClass)\n\t\t\t\t.addClass(me.options.convertedClass);\n\n\t\t},\n\n\t\twrapWords: function(compiled) {\n\t\t\tvar me = this,\n\t\t\t\t$compiled = $(compiled),\n\t\t\t\t$orphans = $compiled.children().slice(-3),\n\t\t\t\twrap = me.createEl(me.options.orphanWrapElement);\n\n\t\t\twrap.className = me.options.orphanWrapClass;\n\t\t\twrap.setAttribute('data-fl', $orphans.first().data('fl'));\n\n\t\t\t$orphans.wrapAll(wrap);\n\t\t\treturn $compiled;\t\t\t\n\t\t},\n\n\t\tcreateEl: function(type) {\n\t\t\treturn window.document.createElement(type);\n\t\t},\n\n\t\tcreateElNS: function(ns, type) {\n\t\t\treturn window.document.createElementNS(ns, type);\n\t\t}\n\t};\n\n\t// A really lightweight plugin wrapper around the constructor,\n\t// preventing against multiple instantiations\n\t$.fn[pluginName] = function ( options ) {\n\t\treturn this.each(function () {\n\t\t\tif (!$.data(this, \"plugin_\" + pluginName)) {\n\t\t\t\t$.data(this, \"plugin_\" + pluginName,\n\t\t\t\tnew Plugin( this, options ));\n\t\t\t}\n\t\t});\n\t};\n\n})( jQuery, window, document );"]}